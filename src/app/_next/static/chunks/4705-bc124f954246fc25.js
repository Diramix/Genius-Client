"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4705],{54705:function(t,e,i){i.d(e,{i$:function(){return k.PlaylistPage},nb:function(){return T}});var a=i(20794),l=i(10576),r=i(97898),d=i(23874),n=i(18796),s=i(73005),o=i(82621),u=i(54146),c=i(39583);let g=(t,e)=>{let[i,l]=t.split(":");return(0,r.pj)({id:i||"",albumId:l||"",key:"".concat(i,"-").concat(e),data:null,loadingState:a.Gui.IDLE})},m=t=>{var e,i,a;let l=null===(e=t.tracks)||void 0===e?void 0:e.map(s.M),d=(null===(i=t.tracks)||void 0===i?void 0:i.length)?null===(a=t.tracks)||void 0===a?void 0:a.map((t,e)=>g(t,e)):[];return{id:t.id,name:t.name,tracks:(0,r.pj)(d),unloadedTracks:(0,r.pj)(l)}},v=t=>{let e=t.filters.map(m);if(e.length<3)return[];let i=e.find(t=>t.id===s.W.ALL);if(!i)return[];let a=e.filter(t=>t.tracks.length>=8);return a.length<2?[]:[i].concat(a.slice(0,7))},N=(t,e)=>e.map(e=>{let i=t.find(t=>String(t.id)===e);return(null==i?void 0:i.albumId)?"".concat(e,":").concat(i.albumId):e}),S=(t,e)=>e.map(e=>{let i=t[e];return(null==i?void 0:i.albumId)?"".concat(i.id,":").concat(i.albumId):String(null==i?void 0:i.id)}),E=(t,e)=>{let{startIndex:i,endIndex:l}=e,r=[];for(let e=i;e<=l;e++){var d,n;((null===(d=t[e])||void 0===d?void 0:d.loadingState)===a.Gui.IDLE||(null===(n=t[e])||void 0===n?void 0:n.loadingState)===a.Gui.REJECT)&&r.push(e)}return r};var I=i(24980);let y=t=>t.map(t=>(0,I.RN)(t.id,t.albumId||void 0)),h=r.V5.model("PlaylistSearchItems",{playlistTrackIds:r.V5.maybeNull(r.V5.array(r.V5.string)),suggestedTrackIds:r.V5.maybeNull(r.V5.array(r.V5.string)),additionTrackInProggress:r.V5.maybeNull(r.V5.string),tracks:r.V5.maybeNull(r.V5.array(u.le))}).views(t=>({get suggestedTracks(){var e;return null===(e=t.suggestedTrackIds)||void 0===e?void 0:e.map(e=>{var i;return(null===(i=t.tracks)||void 0===i?void 0:i.find(t=>t.id===e))||null})},get playlistTracks(){let e=[...t.playlistTrackIds||[]];return t.additionTrackInProggress&&e.unshift(t.additionTrackInProggress),null==e?void 0:e.map(e=>{var i;return(null===(i=t.tracks)||void 0===i?void 0:i.find(t=>{var i;return((null===(i=t.mainAlbum)||void 0===i?void 0:i.id)&&e.includes(":")?"".concat(t.id,":").concat(t.mainAlbum.id):t.id)===e}))||null})}})).actions(t=>({setAdditionTrackAnimation(e){t.additionTrackInProggress=e},replaceAdditionTrackInProggress(){if(t.additionTrackInProggress){var e,i;null===(e=t.playlistTrackIds)||void 0===e||e.unshift(t.additionTrackInProggress),t.suggestedTrackIds=(0,r.pj)(null===(i=t.suggestedTrackIds)||void 0===i?void 0:i.filter(e=>e!==t.additionTrackInProggress)),t.additionTrackInProggress=null}},resetAdditionTrackAnimation(){t.additionTrackInProggress=null}})),T=r.V5.model("PlaylistPage",{uuid:r.V5.maybeNull(r.V5.string),meta:r.V5.maybeNull(o.Nn),items:r.V5.array(s.Wj),errorStatusCode:r.V5.maybeNull(r.V5.number),loadingState:r.V5.enumeration(Object.values(a.Gui)),similarPlaylists:r.V5.array(o.d2),searchLoadingState:r.V5.enumeration(Object.values(a.Gui)),searchItems:h,searchText:r.V5.string,filters:s.Nj,activeFilter:r.V5.maybe(r.V5.string),activeFilterName:r.V5.maybeNull(r.V5.string),shouldSendEventOnTabOpened:r.V5.boolean,initialItems:r.V5.array(s.Wj)}).views(t=>({get isNotFound(){return t.loadingState===a.Gui.REJECT&&t.errorStatusCode===d.CN.NOT_FOUND},get isLoading(){return t.loadingState===a.Gui.PENDING||t.loadingState===a.Gui.IDLE},get isSearchLoading(){return t.searchLoadingState===a.Gui.PENDING||t.searchLoadingState===a.Gui.IDLE},get isSearchIdle(){return t.searchLoadingState===a.Gui.IDLE},get isDisabled(){var e;return t.loadingState===a.Gui.RESOLVE&&(0===t.items.length||!(null===(e=t.meta)||void 0===e?void 0:e.isAvailable))},get isRejected(){return t.loadingState===a.Gui.REJECT},get hasSimilarPlaylists(){return t.loadingState===a.Gui.IDLE||t.loadingState===a.Gui.PENDING||t.similarPlaylists.length>0},get isEmptyPlaylist(){return 0===t.items.length&&t.loadingState===a.Gui.RESOLVE},get contextMeta(){var i,l,s,o,u,g,m,v,N,S;return{isAvailable:null===(i=t.meta)||void 0===i?void 0:i.isAvailable,id:t.meta.id,uid:null===(l=t.meta)||void 0===l?void 0:l.uid,uuid:t.meta.uuid,kind:null===(s=t.meta)||void 0===s?void 0:s.kind,title:null===(o=t.meta)||void 0===o?void 0:o.title,coverUri:null===(u=t.meta)||void 0===u?void 0:u.coverUri,likesCount:null===(g=t.meta)||void 0===g?void 0:g.likesCount,averageColor:null===(m=t.meta)||void 0===m?void 0:m.averageColor,owner:null===(v=t.meta)||void 0===v?void 0:v.owner,description:null===(N=t.meta)||void 0===N?void 0:N.description,modified:null===(S=t.meta)||void 0===S?void 0:S.modified}},get isDragAndDropEnabled(){var E;if(!(0,r.fh)(t))return!1;let{ugcUploadCenter:e}=(0,r.yj)(t);return!!((null===(E=t.meta)||void 0===E?void 0:E.canUserChange)&&(t.items.length>1||e.getUploadingTracksByPlaylistKind(t.meta.kind).length>0))},get itemsKeys(){return t.items.map(t=>t.key)},get isFavouritePlaylist(){var I;return(null===(I=t.meta)||void 0===I?void 0:I.kind)===c.eX.LIKE},get isFiltersLoading(){return t.filters.loadingState===a.Gui.IDLE||t.filters.loadingState===a.Gui.PENDING},get activeFilterIndex(){var y;let e=null===(y=t.filters.items)||void 0===y?void 0:y.findIndex(e=>e.id===t.activeFilter);return e&&e>-1?e:0},get analyticsParamsActiveFilterIndex(){return this.activeFilterIndex+1},get enableVariousAutoFlow(){return!!t.activeFilter},get trackIds(){return t.initialItems.map(t=>String((0,n.i)(t.id,t.albumId)))}})).actions(t=>{let e={getTracksByRange:(0,r.ls)(function*(e){var i,l;let{startIndex:d,endIndex:n}=e,{tracksResource:s,modelActionsLogger:o}=(0,r.dU)(t);if(!(null===(i=t.meta)||void 0===i?void 0:i.uid)||!(null===(l=t.meta)||void 0===l?void 0:l.kind))return null;d=Math.max(0,d),n=Math.min(n,t.items.length);let c=E(t.items,{startIndex:d,endIndex:n});try{let e=S(t.items,c);if(!e.length)return null;c.forEach(e=>{let i=t.items[e];i&&(i.loadingState=a.Gui.PENDING)});let i=yield s.getTracksMeta({trackIds:e,withProgress:!0});c.forEach((e,l)=>{let r=null==i?void 0:i[l];if(t.items[e]&&r){var d,n;t.items[e]={id:r.id,albumId:(null===(n=r.albums)||void 0===n?void 0:null===(d=n[0])||void 0===d?void 0:d.id)||null,key:"".concat(r.id,"-").concat(e),data:(0,u.Vt)(r),loadingState:a.Gui.RESOLVE}}})}catch(e){o.error(e),c.forEach(e=>{let i=t.items[e];i&&(i.loadingState=a.Gui.REJECT)})}return null}),getSearchTracksMeta:(0,r.ls)(function*(){let{tracksResource:e,modelActionsLogger:i}=(0,r.dU)(t),l=[...t.searchItems.playlistTrackIds||[]].concat(t.searchItems.suggestedTrackIds||[]);try{let i=yield e.getTracksMeta({trackIds:l,removeDuplicates:!0,withProgress:!0});t.searchItems.tracks=(0,r.pj)(null==i?void 0:i.map(t=>(0,u.Vt)(t))),t.searchLoadingState!==a.Gui.IDLE&&(t.searchLoadingState=a.Gui.RESOLVE)}catch(t){i.error(t)}return null}),updateData:(0,r.ls)(function*(i){var n;if((null==i?void 0:i.error)==="not-found")return t.errorStatusCode=d.CN.NOT_FOUND,t.loadingState=a.Gui.REJECT,null;t.similarPlaylists=(0,r.pj)(null===(n=i.similarPlaylists)||void 0===n?void 0:n.map(o.VB)),t.meta=(0,o.Q9)(i),t.items=(0,r.pj)(i.tracks.map((t,e)=>({id:String(t.id),albumId:t.albumId||null,key:"".concat(t.id,"-").concat(e),loadingState:a.Gui.IDLE}))),t.initialItems=(0,l.ZN)(t.items);let{sonataState:s}=(0,r.yj)(t);return s.setUnloadedEntitiesData(y(t.items)),yield e.getTracksByRange({startIndex:0,endIndex:10})}),getPlaylistByUserIdAndKind:(0,r.ls)(function*(i){let{userId:l,playlistKind:n,resumeStream:s=!1,trackMetaType:o,preloadedPlaylist:u}=i,{usersResource:c,modelActionsLogger:g}=(0,r.dU)(t);if(t.loadingState!==a.Gui.PENDING)try{t.loadingState=a.Gui.PENDING;let i=u;if(i||(i=yield c.getPlaylistWithTracksIds({userId:l,playlistKind:n,resumeStream:s,trackMetaType:o})),"string"!=typeof i.playlistUuid){t.errorStatusCode=d.CN.NOT_FOUND,t.loadingState=a.Gui.REJECT;return}yield e.updateData(i),t.loadingState=a.Gui.RESOLVE}catch(e){g.error(e),e instanceof d.du&&(e.statusCode===d.CN.NOT_FOUND||e.statusCode===d.CN.BAD_REQUEST)&&(t.errorStatusCode=d.CN.NOT_FOUND),t.loadingState=a.Gui.REJECT}}),getSearchTracks:(0,r.ls)(function*(i){let{uid:l,kind:n}=i,{searchPlaylistResource:s,modelActionsLogger:o}=(0,r.dU)(t);if(t.searchLoadingState!==a.Gui.PENDING&&t.searchText.length)try{t.searchLoadingState=a.Gui.PENDING;let{playlistTrackIds:i=[],suggestedTrackIds:d=[]}=yield s.getTrackIds({uid:l,kind:n,part:t.searchText}),o=N(t.items,i);t.searchItems.playlistTrackIds=(0,r.pj)(o),t.searchItems.suggestedTrackIds=(0,r.pj)(d),e.getSearchTracksMeta()}catch(e){o.error(e),e instanceof d.du&&(e.statusCode===d.CN.NOT_FOUND||e.statusCode===d.CN.BAD_REQUEST)&&(t.errorStatusCode=d.CN.NOT_FOUND),t.searchLoadingState!==a.Gui.IDLE&&(t.searchLoadingState=a.Gui.REJECT)}}),getPlaylistByUuid:(0,r.ls)(function*(i){let{playlistUuid:l,richTracks:n=!1,resumeStream:s=!1,preloadedPlaylist:o}=i,{playlistResource:u,modelActionsLogger:c}=(0,r.dU)(t);if(t.uuid=l,t.loadingState!==a.Gui.PENDING)try{t.loadingState=a.Gui.PENDING;let i=o;i||(i=yield u.getPlaylist({playlistUuid:l,resumeStream:s,richTracks:n})),yield e.updateData(i),t.loadingState!==a.Gui.IDLE&&(t.loadingState=a.Gui.RESOLVE)}catch(e){c.error(e),e instanceof d.du&&(e.statusCode===d.CN.NOT_FOUND||e.statusCode===d.CN.BAD_REQUEST)&&(t.errorStatusCode=d.CN.NOT_FOUND),t.loadingState!==a.Gui.IDLE&&(t.loadingState=a.Gui.REJECT)}}),getPlaylistFilters:(0,r.ls)(function*(){let{filtersResource:i,modelActionsLogger:n}=(0,r.dU)(t),{sonataState:o}=(0,r.yj)(t);if(t.filters.loadingState===a.Gui.PENDING)return;let u=t.items.map(t=>t.id);try{var c;t.filters.loadingState=a.Gui.PENDING;let d=yield i.getTracksFilters({trackIds:u});t.filters.items=(0,r.pj)(v(d)),e.setActiveFilter(o.playlistFilter),e.getFilterName(o.playlistFilter||s.W.ALL);let n=null===(c=t.filters.items)||void 0===c?void 0:c.find(e=>e.id===t.activeFilter);n&&(t.items=(0,l.ZN)(n.tracks),o.setUnloadedEntitiesData(y(t.items))),t.filters.loadingState=a.Gui.RESOLVE}catch(e){n.error(e),e instanceof d.du&&(e.statusCode===d.CN.NOT_FOUND||e.statusCode===d.CN.BAD_REQUEST)&&(t.errorStatusCode=d.CN.NOT_FOUND),t.filters.loadingState=a.Gui.REJECT}}),getFilterName:(0,r.ls)(function*(e){let{filtersResource:i,modelActionsLogger:a}=(0,r.dU)(t);try{let a=yield i.getFilterName({filterId:e});t.activeFilterName=a.name}catch(e){a.error(e),e instanceof d.du&&(e.statusCode===d.CN.NOT_FOUND||e.statusCode===d.CN.BAD_REQUEST)&&(t.errorStatusCode=d.CN.NOT_FOUND)}}),updatePlaylistTrackByUuid:(0,r.ls)(function*(i){let{playlistUuid:l,richTracks:n=!1,resumeStream:s=!1}=i,{playlistResource:o,modelActionsLogger:u}=(0,r.dU)(t);t.uuid=l;try{let i=yield o.getPlaylist({playlistUuid:l,resumeStream:s,richTracks:n}),d=[];if(t.items=(0,r.pj)(i.tracks.map((e,i)=>{var l,r;let n=String(e.id),s=e.albumId||null;return n===(null===(l=t.items[i])||void 0===l?void 0:l.id)&&s===(null===(r=t.items[i])||void 0===r?void 0:r.albumId)?t.items[i]:(d.push(i),{id:String(e.id),albumId:e.albumId||null,key:"".concat(e.id,"-").concat(i),loadingState:a.Gui.IDLE})})),t.meta&&(t.meta.modified=i.modified,t.meta.revision=i.revision,d.length)){let t=Math.min(...d),i=Math.max(...d);e.getTracksByRange({startIndex:t,endIndex:i})}if(t.loadingState!==a.Gui.IDLE&&(t.loadingState=a.Gui.RESOLVE),(0,r.fh)(t)){let{sonataState:e}=(0,r.yj)(t);e.setUnloadedEntitiesData(y(t.items))}}catch(e){u.error(e),e instanceof d.du&&(e.statusCode===d.CN.NOT_FOUND||e.statusCode===d.CN.BAD_REQUEST)&&(t.errorStatusCode=d.CN.NOT_FOUND),t.loadingState!==a.Gui.IDLE&&(t.loadingState=a.Gui.REJECT)}}),moveTrack(e,i){let a=(0,l.ZN)(t.items[e]);if(!(e<0)&&!(i<0)&&!(e>=t.items.length)&&!(i>=t.items.length)&&a&&(t.items.splice(e,1),t.items.splice(i,0,a),(0,r.fh)(t))){let{sonataState:e}=(0,r.yj)(t);e.setUnloadedEntitiesData(y(t.items))}},setSearchIdle(){t.searchLoadingState=a.Gui.IDLE},setActiveFilter(e){e!==s.W.ALL?t.activeFilter=e:t.activeFilter=void 0},removeTracksFromItems(e,i){if(t.items.splice(e,i),(0,r.fh)(t)){let{sonataState:e}=(0,r.yj)(t);e.setUnloadedEntitiesData(y(t.items))}},setSearchText(e){t.searchText=e},handleFilterClick(i){let{sonataState:a}=(0,r.yj)(t);t.activeFilter||(t.initialItems=(0,l.ZN)(t.items)),e.setActiveFilter(i.id),e.getFilterName(i.id),t.activeFilter?t.items=(0,l.ZN)(i.tracks):t.items=(0,l.ZN)(t.initialItems),a.setUnloadedEntitiesData(y(t.items)),e.setShouldSendEventOnTabOpened(!0)},setShouldSendEventOnTabOpened(e){t.shouldSendEventOnTabOpened=e},resetSearch(){t.searchItems.playlistTrackIds=null,t.searchItems.suggestedTrackIds=null,t.searchItems.additionTrackInProggress=null,t.searchItems.tracks=null,t.searchLoadingState=a.Gui.IDLE},reset(){let{sonataState:i}=(0,r.yj)(t);i.resetUnloadedEntitiesData(),t.uuid=null,t.meta=null,t.loadingState=a.Gui.IDLE,t.items=(0,r.pj)([]),t.initialItems=(0,r.pj)([]),t.similarPlaylists=(0,r.pj)([]),t.errorStatusCode=null,t.filters.items=(0,r.pj)([]),t.filters.loadingState=a.Gui.IDLE,t.shouldSendEventOnTabOpened=!0,t.activeFilter=void 0,t.activeFilterName=null,e.resetSearch()},refresh(){var i,a;(null===(i=t.meta)||void 0===i?void 0:i.uuid)&&e.getPlaylistByUuid({playlistUuid:null===(a=t.meta)||void 0===a?void 0:a.uuid,resumeStream:!1})},refreshTracks(){var i,a;(null===(i=t.meta)||void 0===i?void 0:i.uuid)&&e.updatePlaylistTrackByUuid({playlistUuid:null===(a=t.meta)||void 0===a?void 0:a.uuid,resumeStream:!1})}};return e});i(12570);var k=i(79299)}}]);