(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6527],{32431:function(e,t,r){var i={"./default.ts":[70435,435],"./development.ts":[28911,8911],"./production.ts":[9267,9267],"./qa.ts":[1021,1021],"./retryPolicyConfigs/musicExternalApiRetryPolicyConfig.ts":[34960,4960],"./stress.ts":[66027,6027],"./types/BackendsConfig.ts":[44026,4026],"./types/ConfigVariables.ts":[61998,1998],"./types/ConfigVariablesPayment.ts":[88043,8043],"./types/ConfigVariablesPlayer.ts":[51475,1475],"./types/ConfigVariablesResource.ts":[55310,5310],"./utils/getAfishaClientId.ts":[64069,7456],"./utils/getConfig.ts":[81541],"./utils/getPrefixUrl.ts":[80685,685]};function n(e){if(!r.o(i,e))return Promise.resolve().then(function(){var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t});var t=i[e],n=t[0];return Promise.all(t.slice(1).map(r.e)).then(function(){return r(n)})}n.keys=function(){return Object.keys(i)},n.id=32431,e.exports=n},66337:function(e,t,r){"use strict";r.d(t,{$:function(){return u}});var i,n,s=r(35188),o=r(3872),a=r(37205);(i=n||(n={})).WEB="YandexMusicWebNext",i.DESKTOP="YandexMusicDesktopApp";let c=(e,t)=>"".concat(e,"/").concat(t),u=()=>{{let e=(0,a.b)()||"1.0";return c("".concat(n.DESKTOP).concat((0,o.y)((0,s.X)())),e)}}},81541:function(e,t,r){"use strict";async function i(e){let{config:t}=await r(32431)("./".concat(e,".ts"));return t()}r.d(t,{i:function(){return i}})},36648:function(e,t,r){"use strict";r.d(t,{n:function(){return n}});var i=r(43845);let n=e=>{let t=e.resources.musicExternalApi.timeouts;return e.resources.musicExternalApi.defaultTimeout=i.YJ,e.resources.musicExternalApi.timeouts=(0,i.Bz)(t,[{type:"override",value:i.YJ,conditionFn:e=>e<i.YJ}]),e}},6234:function(e,t,r){"use strict";r.d(t,{h:function(){return h}});var i=r(8655),n=r(31674);let s=(e,t)=>e.langs.includes(t)?t:e.defaultLang;var o=r(75546);let a=e=>o.C.parseAcceptLanguage(null!=e?e:void 0),c=e=>new o.C({brandConfig:e,enableWideLanguageSelectWithBrandLangs:!0});var u=r(31490);let l=e=>({ru:u.z3.RU,en:u.z3.EN,uz:u.z3.UZ,kk:u.z3.KK})[e];var d=r(51570);class h{getDefaultLanguage(){return l(s(this.config,this.config.defaultLang))}getLanguage(){return l(s(this.config,this.language))}setLanguage(e){var t,r,i;let n=s(this.config,e);n!==(null===(t=this.storage)||void 0===t?void 0:t.get())&&(null===(r=this.storage)||void 0===r||r.set(n),null===(i=this.changeLanguageHandler)||void 0===i||i.onChangeLanguage(n))}getDictionary(){if(!this.dictionary)throw Error("\n                There is no downloaded CompiledTranslations!\n                I18NStorage.loadDictionary() must be called.\n            ");return this.dictionary}getAvailableLanguages(){return this.config.langs.map(e=>l(s(this.config,e)))}async loadDictionary(){let e=s(this.config,this.language);try{this.dictionary=await (0,d.n)(e)}catch(t){t instanceof Error&&this.logger.error(t,{language:e}),this.dictionary={}}return this.dictionary}constructor({serverDetectedLocale:e,isBuildTypeDesktop:t,storage:r,enableLanguageChanging:o,changeLanguageHandler:u,logger:l}){let d;if((0,i._)(this,"language",void 0),(0,i._)(this,"storage",void 0),(0,i._)(this,"dictionary",void 0),(0,i._)(this,"config",void 0),(0,i._)(this,"logger",void 0),(0,i._)(this,"changeLanguageHandler",void 0),this.storage=r,this.logger=l,this.changeLanguageHandler=u,this.config=n.w8[n.sp],!o){this.language=this.config.defaultLang;return}if(t){if("undefined"!=typeof navigator){var h;d=c(this.config).getLang({cookieLang:(null===(h=this.storage)||void 0===h?void 0:h.get())||void 0,acceptLangs:a(navigator.languages.join())})}}else[d]=a(e)||[];this.language=s(this.config,d)}}},2188:function(e,t,r){"use strict";r.d(t,{c:function(){return n}});var i=r(60991);let n=e=>class extends e{error(e,t){!(e instanceof i.eY)&&(e instanceof Error||"string"==typeof e)&&super.error(e,t)}constructor(e){super(e)}}},5066:function(e,t,r){"use strict";r.d(t,{D:function(){return h},B:function(){return l}});var i,n,s=r(8655),o=r(60991);let a=e=>"object"==typeof e&&null!==e&&"request"in e&&null!==e.request,c=e=>"object"==typeof e&&null!==e&&"response"in e&&"request"in e,u=e=>"object"==typeof e&&null!==e&&"request"in e,l=["headers.cookie","headers.x-ya-service-ticket","headers.x-ya-user-ticket","headers.authorization","headers.set-cookie","requestHeaders.cookie","requestHeaders.x-ya-service-ticket","requestHeaders.x-ya-user-ticket","requestHeaders.authorization","requestHeaders.set-cookie","responseHeaders.set-cookie","responseHeaders.x-ya-service-ticket","responseHeaders.x-ya-user-ticket"],d=["sessionid"];(i=n||(n={})).BeforeRequest="beforeRequest",i.BeforeRetry="beforeRetry",i.BeforeError="beforeError",i.AfterResponse="afterResponse",i.AfterTimeout="afterTimeout";class h{logWithUserId(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"info";t.puid=this.userId.getPassportUid(),this.logger[r](e,t)}async beforeRequest(e){let t=this.normalizeUrl(e.url),r={headers:Object.fromEntries(e.headers),json:e.json,logType:"beforeRequest",method:e.method,url:this.obfuscateUrl(t,d)},[i]=t.split("?");return this.logWithUserId("".concat(e.method," request to ").concat(i||"requestUrlNotFound"),r),Promise.resolve()}normalizeUrl(e){return e instanceof URL?e.toString():e||""}async beforeRetry(e,t){let r={...e,retryCount:t,logType:"beforeRetry"},{cause:i}=e,n="Request retries (retry ".concat(t,")");if(c(i)||a(i)){var s,u,l;let a=this.normalizeUrl(i.request.url||i.request.requestUrl),c=(null===(s=i.request.options)||void 0===s?void 0:s.method)||i.request.method,h=this.getURL(a),v=this.getHeaders((null===(u=i.request.options)||void 0===u?void 0:u.headers)||i.request.headers),g=this.getHeaders(null===(l=i.response)||void 0===l?void 0:l.headers),f=null;e instanceof o.du&&(r.responseHeaders=g,f="with code ".concat(e.statusCode)),f=null!=f?f:"failed without response",n="Request to ".concat(c," Host: ").concat(h.origin," Path: ").concat(h.pathname," retries (retry ").concat(t,") ").concat(f),r.url=this.obfuscateUrl(a,d),r.method=c,r.requestHeaders=v}return this.logWithUserId(n,r,"warn"),Promise.resolve()}async beforeError(e){let t={...e,logType:"beforeError"},{cause:r}=e,i="Request failed without response";if(c(r)||a(r)){var n,s,u;let a=this.normalizeUrl(r.request.url||r.request.requestUrl),c=(null===(n=r.request.options)||void 0===n?void 0:n.method)||r.request.method,l=this.getURL(a),h=this.getHeaders((null===(s=r.request.options)||void 0===s?void 0:s.headers)||r.request.headers),v=this.getHeaders(null===(u=r.response)||void 0===u?void 0:u.headers),g=null;e instanceof o.du&&(t.responseHeaders=v,g="failed with code ".concat(e.statusCode)),g=null!=g?g:"failed without response",i="Request to ".concat(c," Host: ").concat(l.origin," Path: ").concat(l.pathname," ").concat(g),t.url=this.obfuscateUrl(a,d),t.method=c,t.requestHeaders=h}return this.logWithUserId(i,t,"error"),Promise.resolve(e)}async afterTimeout(e){let t={...e,logType:"afterTimeout"},{cause:r}=e,i="Request failed with Timeout";if(u(r)&&e instanceof o.du){var n,s;let e=this.normalizeUrl(r.request.url||r.request.requestUrl),o=(null===(n=r.request.options)||void 0===n?void 0:n.method)||r.request.method,a=this.getURL(e),c=this.getHeaders((null===(s=r.request.options)||void 0===s?void 0:s.headers)||r.request.headers);i="Request to ".concat(o," Host: ").concat(a.origin," Path: ").concat(a.pathname," failed with Timeout"),t.url=this.obfuscateUrl(e,d),t.method=o,t.requestHeaders=c}return this.logWithUserId(i,t,"error"),Promise.resolve(e)}afterResponse(e){let t=this.normalizeUrl(e.url),r={headers:e.headers,statusCode:e.statusCode,statusMessage:e.statusMessage,url:this.obfuscateUrl(t,d),logType:"afterResponse",puid:void 0},[i]=t.split("?");return this.logWithUserId("Response from ".concat(i||"requestUrlNotFound"," ").concat(e.statusCode," (").concat(e.statusMessage,")"),r),e}getURL(e){let[t]=e.split("?");return new URL(t||"https://unknown")}obfuscateUrl(e,t){let r=new URL(e),i=r.searchParams;for(let e of t)i.has(e)&&i.set(e,"***");return r.toString()}getHeaders(e){return e instanceof Headers?Object.fromEntries(e.entries()):e}get beforeRequestHook(){return this.beforeRequest.bind(this)}get beforeRetryHook(){return this.beforeRetry.bind(this)}get beforeErrorHook(){return this.beforeError.bind(this)}get afterTimeoutHook(){return this.afterTimeout.bind(this)}get afterResponseHook(){return this.afterResponse.bind(this)}constructor(e,t){(0,s._)(this,"userId",void 0),(0,s._)(this,"logger",void 0),this.userId=t,this.logger=e}}},42461:function(e,t,r){"use strict";r.d(t,{E:function(){return n}});var i=r(8655);class n{setPassportUid(e){this.passportUid=e}getPassportUid(){return this.passportUid}constructor(){(0,i._)(this,"passportUid",void 0)}}},9617:function(e,t,r){"use strict";r.d(t,{s1:function(){return c},d5:function(){return l},ri:function(){return u}});var i=r(8655),n=r(37810);class s extends n.y{constructor(e="Internal error",{code:t="E_CONTAINER",...r}={}){super(e,{code:t,...r}),(0,i._)(this,"name","ContainerException"),Object.setPrototypeOf(this,s.prototype)}}class o extends s{constructor(e){super("A binding with the name '".concat(e.toString(),"' already exists in the container"),{code:"E_CONTAINER_ALREADY_EXISTS"}),(0,i._)(this,"name","AlreadyExistsContainerException"),Object.setPrototypeOf(this,o.prototype)}}class a extends s{constructor(e){super("No entry with the name '".concat(e.toString(),"' was found in the container"),{code:"E_CONTAINER_NOT_FOUND"}),(0,i._)(this,"name","NotFoundContainerException"),Object.setPrototypeOf(this,a.prototype)}}class c{register(e,t){if(this.has(e))throw new o(e);return this.bindings={...this.bindings,[e]:t},this}registerMany(e){for(let t in e)if(this.has(t))throw new o(t);return this.bindings={...this.bindings,...e},this}get(e){if(this.shared.has(e))return this.shared.get(e);let t=this.bindings[e];if(void 0===t)throw new a(e);let r=this.create(t);return t.isShared&&this.shared.set(e,r),r}has(e){return e in this.bindings}create(e){return e.creator(this)}constructor(){(0,i._)(this,"bindings",{}),(0,i._)(this,"shared",new Map)}}function u(e){return{type:"singleton",creator:e,isShared:!0}}function l(e){return{type:"factory",creator:e,isShared:!1}}},23645:function(e,t,r){"use strict";r.d(t,{w:function(){return m}});var i=r(8655),n=r(98782),s=r(21362),o=r(78694),a=r(77424),c=r(54194),u=r(13281);let l=e=>Object.keys(e.statusCodes).filter(e=>!isNaN(Number(e))).map(e=>parseInt(e,10)),d=e=>(null==e?void 0:e.code)==="ETIMEDOUT"?"TIMEOUT":e.response&&(e.response.status||e.response.statusCode)||"NON_HTTP_ERROR",h={retryLimit:0,retryDelay:0},v=e=>{let{retryAttempt:t,error:r,isNotIdempotent:i,retryAfter:n,retryPolicyConfig:s}=e;if(!s||i)return h;if(n)return s.totalRequestsLimit>t?{retryLimit:s.totalRequestsLimit,retryDelay:n}:h;if(s.statusCodes[r]){var o;let e=s.statusCodes[r];if((null==e?void 0:null===(o=e.attempts)||void 0===o?void 0:o.length)&&e.attempts.length>=t)return{retryLimit:e.attempts.length+1,retryDelay:e.attempts[t-1]||1}}return h},g=async e=>new Promise(t=>setTimeout(t,e)),f=async e=>{var t,r;let{request:i,options:n,error:s,retryAttempt:o,clientRetryConfig:a}=e;i.headers.set("X-Retry-Count",String(o));let[c]=(i.headers.get("X-Request-Id")||"").split(".");if(c&&i.headers.set("X-Request-Id","".concat(c,".").concat(String(o))),null==s?void 0:null===(r=s.response)||void 0===r?void 0:null===(t=r.headers)||void 0===t?void 0:t.get("Retry-After"))return;let u=v({error:d(s),retryAttempt:o,retryPolicyConfig:null==a?void 0:a.config,isNotIdempotent:null==a?void 0:a.isNotIdempotent});n.retry.limit=u.retryLimit,await g(u.retryDelay)},y=["GET","POST","PUT","PATCH","DELETE","HEAD","get","post","put","patch","delete","head"];class m{async get(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request(e,{...t,method:"GET"})}async post(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request(e,{...t,method:"POST"})}async put(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request(e,{...t,method:"PUT"})}async patch(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request(e,{...t,method:"PATCH"})}async delete(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request(e,{...t,method:"DELETE"})}async head(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request(e,{...t,method:"HEAD"})}async request(e,t){let r,i;try{let i=Date.now(),n=await this.client(e,this.optionsConverter(t)),s=Date.now()-i;return r=this.responseConverter(n,t,{start:i,response:s})}catch(e){if(e instanceof n.B)throw this.errorConverter(e);if(i=e,e instanceof s.W)throw this.afterTimeoutHooks.forEach(t=>{t(this.errorConverter(e))}),this.errorConverter(e);throw e}finally{this.requestDoneHooks.forEach(n=>{n({url:e,options:t,response:r,error:i})})}}optionsConverter(e){let{prefixUrl:t,method:r,searchParams:i,headers:n,json:s,hooks:o,retry:a,timeout:c,body:u,credentials:d,signal:h}=e,v={};if(void 0!==d&&(v.credentials=d),void 0!==t&&(v.prefixUrl=t),void 0!==r&&(v.method=r),void 0!==n){var g;v.headers={...n,"user-agent":null!==(g=n["user-agent"])&&void 0!==g?g:n["User-Agent"]}}if(void 0!==i&&(v.searchParams=i),void 0!==s&&(v.json=s),"number"==typeof c&&(v.timeout=c),void 0!==u&&(v.body=u),void 0!==h&&(v.signal=h),(null==a?void 0:a.config)&&(v.retry={limit:a.config.totalRequestsLimit,backoffLimit:1,statusCodes:l(a.config)},v.hooks=v.hooks||{},v.hooks.beforeRetry=v.hooks.beforeRetry||[],v.hooks.beforeRetry.push(async e=>{await f({request:e.request,options:e.options,error:e.error,retryAttempt:e.retryCount,clientRetryConfig:a})})),o){let e;let{beforeRequest:t,beforeRetry:r,beforeError:i,afterResponse:n}=o;void 0===v.hooks&&(v.hooks={}),Array.isArray(t)&&(v.hooks.beforeRequest=t.map(t=>async(r,i)=>{e=Date.now();let n={...this.normalizeOptions(r,i),headers:r.headers};await t(n)})),Array.isArray(r)&&(v.hooks.beforeRetry=v.hooks.beforeRetry||[],v.hooks.beforeRetry=v.hooks.beforeRetry.concat(r.map(e=>async t=>{let{request:r,options:i,error:n,retryCount:s}=t;await e(this.errorConverter(n,r,i),s)}))),Array.isArray(i)&&(v.hooks.beforeError=i.map(e=>async t=>(await e(this.errorConverter(t)),t))),Array.isArray(n)&&(v.hooks.afterResponse=n.map(t=>async(r,i,n)=>{let s=this.normalizeOptions(r,i),o=Date.now();return await t(this.responseConverter(n,s,{start:e,response:o})),n}))}return v}responseConverter(e,t,r){return{headers:Object.fromEntries(e.headers.entries()),statusCode:e.status,statusMessage:e.statusText,url:e.url,json:e.json.bind(e),text:e.text.bind(e),arrayBuffer:e.arrayBuffer.bind(e),timings:r,clone:()=>this.responseConverter(e.clone(),t,r),request:{prefixUrl:t.prefixUrl,headers:t.headers,searchParams:t.searchParams,method:t.method}}}normalizeOptions(e,t){let r=new URL(e.url);return{headers:this.normalizeHeaders(t.headers),searchParams:new URLSearchParams(r.search),json:e.json,url:e.url,method:this.convertMethod(t.method),timeout:void 0,signal:e.signal}}normalizeHeaders(e){return void 0===e?{}:e instanceof Headers?Object.fromEntries(e.entries()):Array.isArray(e)?Object.fromEntries(e):e}errorConverter(e,t,r){if(e instanceof n.B||e instanceof s.W)return new u.d(e.message,{statusCode:e instanceof s.W?a.C.REQUEST_TIMEOUT:e.response.status,cause:e});let i=null;return t&&r&&(i={headers:null==r?void 0:r.headers,url:null==t?void 0:t.url,method:null==t?void 0:t.method}),new c.e(e.message,{cause:{error:e,request:i}})}convertMethod(e){return void 0!==e&&y.includes(e)?e.toUpperCase():"GET"}convertMethods(e){let t=new Set;return e.forEach(e=>{y.includes(e)&&t.add(e.toUpperCase())}),[...t]}constructor(e={}){var t,r,n,s;(0,i._)(this,"client",void 0),(0,i._)(this,"afterTimeoutHooks",[]),(0,i._)(this,"requestDoneHooks",[]),this.client=o.ZP.create(this.optionsConverter(e)),this.afterTimeoutHooks=null!==(n=null===(t=e.hooks)||void 0===t?void 0:t.afterTimeout)&&void 0!==n?n:[],this.requestDoneHooks=null!==(s=null===(r=e.hooks)||void 0===r?void 0:r.onRequestDone)&&void 0!==s?s:[]}}},13281:function(e,t,r){"use strict";r.d(t,{d:function(){return s}});var i=r(8655),n=r(54194);class s extends n.e{constructor(e,t){super(e,{code:"E_HTTP_CLIENT_NON_2XX_3XX_RESPONSE",cause:t.cause}),(0,i._)(this,"name","HttpErrorException"),(0,i._)(this,"statusCode",void 0),this.statusCode=t.statusCode,Object.setPrototypeOf(this,s.prototype)}}},54194:function(e,t,r){"use strict";r.d(t,{e:function(){return s}});var i=r(8655),n=r(37810);class s extends n.y{constructor(e="Http Client error",{code:t="E_HTTP_CLIENT",...r}={}){super(e,{code:t,...r}),(0,i._)(this,"name","HttpException"),Object.setPrototypeOf(this,s.prototype)}}},60991:function(e,t,r){"use strict";r.d(t,{CN:function(){return i.C},du:function(){return s.d},eY:function(){return n.e}});var i=r(77424),n=r(54194),s=r(13281)},77424:function(e,t,r){"use strict";var i,n;r.d(t,{C:function(){return i}}),(n=i||(i={}))[n.NOT_FOUND=404]="NOT_FOUND",n[n.BAD_REQUEST=400]="BAD_REQUEST",n[n.REQUEST_TIMEOUT=408]="REQUEST_TIMEOUT",n[n.PRECONDITION_FAILED=412]="PRECONDITION_FAILED"},88812:function(e,t,r){"use strict";r.d(t,{r:function(){return g}});var i=r(29348);class n{get delete(){var e;return null===(e=this.cursor.delete)||void 0===e?void 0:e.bind(this.cursor)}get update(){var e;return null===(e=this.cursor.update)||void 0===e?void 0:e.bind(this.cursor)}[Symbol.asyncIterator](){return this.cursor[Symbol.asyncIterator]()}constructor(e){Object.defineProperty(this,"cursor",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"key",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"direction",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"request",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"primaryKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"advance",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"continue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"continuePrimaryKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.direction=e.direction,this.request=e.request,this.primaryKey=e.primaryKey,this.key=e.key,this.advance=e.advance.bind(e),this.continue=e.continue.bind(e),this.continuePrimaryKey=e.continuePrimaryKey.bind(e)}}class s extends n{[Symbol.asyncIterator](){return this.cursor[Symbol.asyncIterator]()}constructor(e){super(e),Object.defineProperty(this,"cursor",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.value=e.value}}var o=function(e,t,r,i){return new(r||(r=Promise))(function(n,s){function o(e){try{c(i.next(e))}catch(e){s(e)}}function a(e){try{c(i.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?n(e.value):((t=e.value)instanceof r?t:new r(function(e){e(t)})).then(o,a)}c((i=i.apply(e,t||[])).next())})};class a{get(e){return o(this,void 0,void 0,function*(){return this.index.get(e)})}getAll(e,t){return o(this,void 0,void 0,function*(){return this.index.getAll(e,t)})}getAllKeys(e,t){return o(this,void 0,void 0,function*(){return this.index.getAllKeys(e,t)})}getKey(e){return o(this,void 0,void 0,function*(){return this.index.getKey(e)})}count(e){return o(this,void 0,void 0,function*(){return this.index.count(e)})}openCursor(e,t){return o(this,void 0,void 0,function*(){let r=yield this.index.openCursor(e,t);return r&&new s(r)})}openKeyCursor(e,t){return o(this,void 0,void 0,function*(){let r=yield this.index.openKeyCursor(e,t);return r&&new n(r)})}[Symbol.asyncIterator](){return this.index[Symbol.asyncIterator]()}iterate(e,t){return this.index.iterate(e,t)}constructor(e){Object.defineProperty(this,"index",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"keyPath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"multiEntry",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"unique",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keyPath=e.keyPath,this.multiEntry=e.multiEntry,this.name=e.name,this.unique=e.unique}}var c=function(e,t,r,i){return new(r||(r=Promise))(function(n,s){function o(e){try{c(i.next(e))}catch(e){s(e)}}function a(e){try{c(i.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?n(e.value):((t=e.value)instanceof r?t:new r(function(e){e(t)})).then(o,a)}c((i=i.apply(e,t||[])).next())})};class u{get indexNames(){return this.objectStore.indexNames}get put(){var e;return null===(e=this.objectStore.put)||void 0===e?void 0:e.bind(this.objectStore)}get add(){var e;return null===(e=this.objectStore.add)||void 0===e?void 0:e.bind(this.objectStore)}get clear(){var e;return null===(e=this.objectStore.clear)||void 0===e?void 0:e.bind(this.objectStore)}get delete(){var e;return null===(e=this.objectStore.delete)||void 0===e?void 0:e.bind(this.objectStore)}createIndex(e,t,r){return this.objectStore.createIndex?new a(this.objectStore.createIndex(e,t,r)):null}deleteIndex(e){return this.objectStore.deleteIndex(e)}count(e){return c(this,void 0,void 0,function*(){return this.objectStore.count(e)})}get(e){return c(this,void 0,void 0,function*(){return this.objectStore.get(e)})}getAll(e,t){return c(this,void 0,void 0,function*(){return this.objectStore.getAll(e,t)})}getAllKeys(e,t){return c(this,void 0,void 0,function*(){return this.objectStore.getAllKeys(e,t)})}getKey(e){return c(this,void 0,void 0,function*(){return this.objectStore.getKey(e)})}index(e){return new a(this.objectStore.index(e))}openKeyCursor(e,t){return c(this,void 0,void 0,function*(){let r=yield this.objectStore.openKeyCursor(e,t);return r&&new n(r)})}openCursor(e,t){return c(this,void 0,void 0,function*(){let r=yield this.objectStore.openCursor(e,t);return r&&new s(r)})}iterate(e,t){return this.objectStore.iterate(e,t)}[Symbol.asyncIterator](){return this.objectStore[Symbol.asyncIterator]()}constructor(e){Object.defineProperty(this,"objectStore",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"autoIncrement",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"keyPath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.autoIncrement=e.autoIncrement,this.keyPath=e.keyPath,this.name=e.name}}class l{get error(){return this.transaction.error}get done(){return this.transaction.done}abort(){return this.transaction.abort()}commit(){return this.transaction.commit()}objectStore(e){return new u(this.transaction.objectStore(e))}addEventListener(e,t,r){return this.transaction.addEventListener(e,t,r)}removeEventListener(e,t,r){return this.transaction.removeEventListener(e,t,r)}set onabort(e){this.transaction.onabort=e}set onerror(e){this.transaction.onerror=e}set oncomplete(e){this.transaction.oncomplete=e}dispatchEvent(e){return this.transaction.dispatchEvent(e)}constructor(e){Object.defineProperty(this,"transaction",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"durability",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"mode",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"objectStoreNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.durability=e.durability,this.mode=e.mode,this.objectStoreNames=e.objectStoreNames}}var d=function(e,t,r,i){return new(r||(r=Promise))(function(n,s){function o(e){try{c(i.next(e))}catch(e){s(e)}}function a(e){try{c(i.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?n(e.value):((t=e.value)instanceof r?t:new r(function(e){e(t)})).then(o,a)}c((i=i.apply(e,t||[])).next())})};class h{get objectStoreNames(){return this.database.objectStoreNames}transaction(e,t,r){return new l(this.database.transaction(e,t,r))}createObjectStore(e,t){return new u(this.database.createObjectStore(e,t))}deleteObjectStore(e){return this.database.deleteObjectStore(e)}get(e,t){return d(this,void 0,void 0,function*(){return this.database.get(e,t)})}getAll(e,t,r){return d(this,void 0,void 0,function*(){return this.database.getAll(e,t,r)})}add(e,t,r){return d(this,void 0,void 0,function*(){return this.database.add(e,t,r)})}put(e,t,r){return d(this,void 0,void 0,function*(){return this.database.put(e,t,r)})}delete(e,t){return d(this,void 0,void 0,function*(){return this.database.delete(e,t)})}clear(e){return d(this,void 0,void 0,function*(){return this.database.clear(e)})}count(e,t){return d(this,void 0,void 0,function*(){return this.database.count(e,t)})}getKey(e,t){return d(this,void 0,void 0,function*(){return this.database.getKey(e,t)})}getAllKeys(e,t,r){return d(this,void 0,void 0,function*(){return this.database.getAllKeys(e,t,r)})}countFromIndex(e,t,r){return d(this,void 0,void 0,function*(){return this.database.countFromIndex(e,t,r)})}getFromIndex(e,t,r){return d(this,void 0,void 0,function*(){return this.database.getFromIndex(e,t,r)})}getAllFromIndex(e,t,r,i){return d(this,void 0,void 0,function*(){return this.database.getAllFromIndex(e,t,r,i)})}getAllKeysFromIndex(e,t,r,i){return d(this,void 0,void 0,function*(){return this.database.getAllKeysFromIndex(e,t,r,i)})}getKeyFromIndex(e,t,r){return d(this,void 0,void 0,function*(){return this.database.getKeyFromIndex(e,t,r)})}addEventListener(e,t,r){this.database.addEventListener(e,t,r)}removeEventListener(e,t,r){this.database.removeEventListener(e,t,r)}set onabort(e){this.database.onabort=e}set onclose(e){this.database.onclose=e}set onerror(e){this.database.onerror=e}set onversionchange(e){this.database.onversionchange=e}close(){return this.database.close()}dispatchEvent(e){return this.database.dispatchEvent(e)}constructor(e){Object.defineProperty(this,"database",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"version",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.version=e.version,this.name=e.name}}var v=function(e,t,r,i){return new(r||(r=Promise))(function(n,s){function o(e){try{c(i.next(e))}catch(e){s(e)}}function a(e){try{c(i.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?n(e.value):((t=e.value)instanceof r?t:new r(function(e){e(t)})).then(o,a)}c((i=i.apply(e,t||[])).next())})};class g{openDB(e){let{onBlocked:t,onBlocking:r,onTerminated:n,onUpgrade:s}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return v(this,void 0,void 0,function*(){let o=yield(0,i.X3)(this.name,e,{blocked:t,blocking:r,terminated:n,upgrade:(e,t,r,i,n)=>{let o=new h(e);null==s||s(o,t,r,new l(i),n)}});return new h(o)})}deleteDB(e){let{onBlocked:t}=e;return v(this,void 0,void 0,function*(){yield(0,i.Lj)(this.name,{blocked:t})})}constructor(e){Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:e})}}},18145:function(e,t,r){"use strict";r.d(t,{P:function(){return u}});var i=r(8655),n=r(59678),s=r(26965),o=r(9748),a=r(45813);let c=()=>"SECRET";class u{formatMessage(e,t){let r,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=arguments.length>3?arguments[3]:void 0,a=String(t instanceof Error&&t.stack?t.stack:t),c=(0,s.Z)(i);return(Object.keys(c).length&&(r=this.obfuscateData(c)),o)?"".concat(a," ").concat(n(r)):[a,r]}obfuscateData(e){var t;if(null===(t=this.secureFields)||void 0===t?void 0:t.length)for(let t of this.secureFields)void 0!==(0,o.Z)(e,t)&&(0,a.Z)(e,t,c());return e}constructor({maxLogLevel:e,secureFields:t}){(0,i._)(this,"maxLogLevel",void 0),(0,i._)(this,"secureFields",void 0),this.maxLogLevel=e,this.secureFields=t}}},31256:function(e,t,r){"use strict";r.d(t,{j:function(){return o}});var i=r(8655),n=r(41174),s=r(18145);class o extends s.P{info(e,t){this.maxLogLevel>=n.B.INFO&&this.logToConsole(n.B.INFO,e,t)}debug(e,t){this.maxLogLevel>=n.B.DEBUG&&this.logToConsole(n.B.DEBUG,e,t)}trace(e,t){this.maxLogLevel>=n.B.TRACE&&this.logToConsole(n.B.TRACE,e,t)}warn(e,t){this.maxLogLevel>=n.B.WARNING&&this.logToConsole(n.B.WARNING,e,t),this.sendToErrorBooster(n.B.WARNING,e,t)}error(e,t){this.maxLogLevel>=n.B.ERROR&&this.logToConsole(n.B.ERROR,e,t),this.sendToErrorBooster(n.B.ERROR,e,t)}log(e,t){this.logToConsole(n.B.INFO,e,t)}logToConsole(e,t,r){if(this.disableLogToConsole)return;let i=n.v[e];console[i](...this.formatMessage(e,t,r))}sendToErrorBooster(e,t,r){window.Ya.Rum.logError({message:t,level:e,additional:{data:r?this.obfuscateData(r):{}}})}constructor(e){super(e),(0,i._)(this,"disableLogToConsole",void 0),this.disableLogToConsole=e.disableLogToConsole}}},45113:function(e,t,r){"use strict";r.d(t,{B$:function(){return i.B}});var i=r(41174);r(18145)},41174:function(e,t,r){"use strict";var i,n;r.d(t,{B:function(){return i},v:function(){return s}}),(n=i||(i={}))[n.ERROR=10]="ERROR",n[n.WARNING=20]="WARNING",n[n.INFO=30]="INFO",n[n.DEBUG=40]="DEBUG",n[n.TRACE=50]="TRACE";let s={[i.ERROR]:"error",[i.WARNING]:"warn",[i.INFO]:"info",[i.DEBUG]:"debug",[i.TRACE]:"trace"}},43845:function(e,t,r){"use strict";r.d(t,{YJ:function(){return n},ys:function(){return i},mZ:function(){return u},Bz:function(){return c}});let i=2e3,n=1e4;var s=r(26965),o=r(9748),a=r(45813);let c=(e,t)=>{let r=(0,s.Z)(e);return Object.values(r).forEach(e=>{e&&Object.keys(e).forEach(r=>{let i=t.reduce((e,t)=>{let{type:r,value:i,conditionFn:n=()=>!0}=t;if(!n(e))return e;switch(r){case"sum":return e+i;case"multiply":return e*i;case"devide":return e/i;case"override":return i;default:return e}},(0,o.Z)(e,[r]));(0,a.Z)(e,[r],i)})}),r},u=c({rotorResource:{getStationInfo:180,sessionNew:i,sessionTracks:i,sessionFeedback:450,waveLast:170,waveSettings:180,waveLastReset:30},accountResource:{experiments:130,experimentsDetails:110,settings:190,about:600},albumsResource:{getAlbumWithTracksIds:1500,getAlbumWithRichTracks:i,getDisclaimer:150,getTrailer:i,getRelatedContent:1e3,getAlbums:1e3},artistsResource:{getArtistTracks:650,getArtistTrackIds:310,getSafeDirectAlbums:210,getBriefInfo:600,getSimilarArtists:90,getConcerts:100,getFamiliarYouInfo:250,getFamiliarYou:500,getDisclaimer:150,getTrailer:i},clipsResource:{getCredits:200},chartResource:{getChart:i},dynamicPagesResource:{getTriggers:3e3,getTrigger:3e3,shown:3e3,action:3e3},filtersResource:{getTracksFilters:i,getFilterName:i},libraryResource:{getAllIds:260},searchResource:{getInstantMixedSearch:1e3,sendFeedback:170},searchPlaylistResource:{getTrackIds:2e3},slidesResource:{getUserSlides:500,getArtistSlides:500},topResource:{getTopByGenre:1e3},tracksResource:{getStorageData:140,getSrcData:i,getTracksMeta:2700,getDisclaimer:150,getFullInfoTrack:400,getFullDescriptionTrack:300,getCredits:400,getLyrics:80,getTrailer:i},usersResource:{getLikedAlbums:250,getLikedArtists:250,getDislikedArtists:200,getLikedPlaylists:480,getPlaylistsKinds:800,createPlaylist:500,getPlaylistsByKinds:800,getCreatedPlaylists:670,changePlaylistTitle:i,changePlaylistDescription:i,uploadPlaylistCover:i,deletePlaylist:i,getPlaylistTrailer:i,getPlaylistWithTracksIds:1e3,getPlaylistWithRichTracks:1500,getSearchHistory:220,clearSearchHistory:60,likeTrack:300,unlikeTrack:60,likeArtist:230,unlikeArtist:120,likeAlbum:120,unlikeAlbum:70,likePlaylist:120,unlikePlaylist:90,dislikeArtist:40,undislikeArtist:400,dislikeTrack:140,undislikeTrack:300,getPresaves:300,presaveAlbum:200,removePresaveAlbum:300},playlistResource:{getPlaylist:1e3},playlistsResource:{getPlaylists:i},landingResource:{getSkeleton:5e3,getBlock:i},landing3Resource:{getMetatags:i},loaderResource:{getUploadUrl:i},metatagsResource:{getMetatagById:i},pinResource:{pinAlbum:i,unpinAlbum:i,pinPlaylist:i,unpinPlaylist:i,pinArtist:i,unpinArtist:i,pinWave:i,unpinWave:i},pinsResource:{getPins:i},getFileInfoResource:{getFileInfo:i,getByteRange:i},tagResource:{getPlaylistIds:i},feedResource:{getPromotionsById:i,getWizardGenres:1e3,getWizardArtistsByGenre:1e3,finishWizard:1e3},musicHistoryResource:{getMusicHistory:i,getMusicHistoryItems:i},streamsResource:{progressSync:150,markAlbumFinished:150,markAlbumUnfinished:150,markFinished:350,markUnfinished:150},lyricViewsResource:{sendViews:140},nonMusicResource:{getShelfRecentlyPlayed:500,getShelfLiked:1e3,getPlaylists:200,getNewEpisodes:1e3,getEditorialAlbums:200,getCategory:2e3,getCategoryAlbums:200},donationResource:{getAlbumDonations:i},prefixlessResource:{uploadFile:4e5,reportForAlbumPromo:i,getLyricsText:i},offersResource:{getCompositeOffers:i},afterTrackResource:{getAfterTrack:i},ugcResource:{changeTrack:200},collectionResource:{sync:1e3}},[{type:"override",value:200,conditionFn:e=>e<200},{type:"multiply",value:1.5,conditionFn:e=>e>=1e3},{type:"multiply",value:2,conditionFn:e=>e<1e3},{type:"sum",value:200}])},45670:function(e,t,r){"use strict";r.d(t,{Jc:function(){return m},Jt:function(){return ev},Ju:function(){return eb}});var i,n,s,o,a,c,u,l,d,h,v,g,f,y,m,p,b=r(8655),w=r(81786),T=r(31490);(i=l||(l={})).TRACK_META_RECEIVED="track_meta_received",i.TRACK_DECRYPT_KEY_RECEIVED="track_decrypt_key_received",i.CHUNK_MEDIA_FILE_RECEIVED="chunk_media_file_received";class E{downloadTrack(e){this.queue.push(e),this.startNextDownload()}downloadTracks(e){this.queue.push(...e),this.startNextDownload()}async getFileInfo(e,t){let r=(0,T.IT)(),i=this.variables.codecs.join(""),n="".concat(r).concat(e).concat(t).concat(i).concat(this.transport),s=await (0,T.Uh)({secretKey:this.secretKey,data:n});return this.getFileInfoResource.getFileInfo({tsInSeconds:r,trackId:e,quality:t,codecs:this.variables.codecs,transports:[this.transport],sign:s})}async download(e){let[t]=await this.tracksResource.getTracksMeta({trackIds:[e]});if(!t||!t.available){this.removeTrackFromActiveDownloads(e);return}this.events.emit(l.TRACK_META_RECEIVED,t);let{downloadInfo:r}=await this.getFileInfo(t.id,this.variables.quality);if(r.transport!==T.J7.ENCRAW){this.removeTrackFromActiveDownloads(e);return}this.events.emit(l.TRACK_DECRYPT_KEY_RECEIVED,String(t.id),r.key);let i=null,n=0,s=r.urls[0];if(!s){this.removeTrackFromActiveDownloads(e);return}let o=async()=>{let e=0;null===i||n+this.variables.chunkSize<i?e=n+this.variables.chunkSize-1:n+this.variables.chunkSize>=i&&(e=i);let{contentLength:r,data:a,contentRange:c}=await this.getFileInfoResource.getByteRange({srcUrl:s,start:n,end:e});n+=r,i=Number(c.split("/")[1]),this.events.emit(l.CHUNK_MEDIA_FILE_RECEIVED,String(t.id),{data:a,progress:Math.floor(n/i*100)}),null!==i&&n<i&&o()};o().finally(()=>{this.removeTrackFromActiveDownloads(e),this.startNextDownload()})}startNextDownload(){let e=this.activeDownloads.length;e<this.variables.maxConcurrentDownloads&&this.queue.length>0&&this.queue.splice(0,this.variables.maxConcurrentDownloads-e).forEach(e=>{this.activeDownloads.push(e),this.download(e)})}removeTrackFromActiveDownloads(e){let t=this.activeDownloads.indexOf(e);-1!==t&&this.activeDownloads.splice(t,1)}constructor(e){(0,b._)(this,"httpClient",void 0),(0,b._)(this,"tracksResource",void 0),(0,b._)(this,"getFileInfoResource",void 0),(0,b._)(this,"secretKey",void 0),(0,b._)(this,"transport",void 0),(0,b._)(this,"variables",void 0),(0,b._)(this,"events",new w.Q),(0,b._)(this,"activeDownloads",[]),(0,b._)(this,"queue",[]),this.httpClient=e.httpClient,this.variables=e.variables,this.tracksResource=new T.HZ(this.httpClient,e.tracksResourceParams),this.getFileInfoResource=new T.dF(this.httpClient,e.getFileInfoResourceParams.resourceConfig),this.secretKey=e.getFileInfoResourceParams.secretKey,this.transport=e.getFileInfoResourceParams.transport}}let R=()=>"undefined"==typeof navigator?{isOffline:!1}:{isOffline:!navigator.onLine};class C{updateStatus(e){this.status=R(),e(this.status)}subscribe(e){this.updateStatus(e),window.addEventListener("online",this.updateStatus.bind(this,e)),window.addEventListener("offline",this.updateStatus.bind(this,e))}unsubscribe(e){window.removeEventListener("online",this.updateStatus.bind(this,e)),window.removeEventListener("offline",this.updateStatus.bind(this,e))}constructor(){(0,b._)(this,"status",R())}}var k=r(37810);(n=d||(d={})).DEFAULT="E_FILE_STORAGE",n.NOT_AVAILABLE="E_FILE_STORAGE_NOT_AVAILABLE",n.INVALID_PATH="E_FILE_STORAGE_INVALID_PATH";class A extends k.y{constructor(e="File storage error",{code:t=d.DEFAULT,...r}={}){super(e,{code:t,...r}),(0,b._)(this,"name","FileStorageException"),Object.setPrototypeOf(this,A.prototype)}}class I{async getRootDir(){if(!this.isAvailable||!this.rootDir)throw new A("FileStorage is not available",{code:d.NOT_AVAILABLE});return this.rootDir}parsePath(e){let t=e.split("/"),r=t.pop();if(!r)throw new A("Invalid file path",{code:d.INVALID_PATH,data:{path:e}});return{name:r,dir:t.join("/")}}async getDirectoryRecursive(e,t,r){let i=t.shift();if(!i)return e;let n=await e.getDirectoryHandle(i,r);return this.getDirectoryRecursive(n,t,r)}async getDirectory(e,t){let r=e.split("/"),i=await this.getRootDir();return this.getDirectoryRecursive(i,r,t)}async getFile(e,t){let{name:r,dir:i}=this.parsePath(e);return(await this.getDirectory(i,t)).getFileHandle(r,t)}async writeFile(e,t){let r=await this.getFile(e,{create:!0}),i=await r.createWritable();await i.write(t),await i.close()}async appendFile(e,t){let r=await this.getFile(e,{create:!0}),[i,n]=await Promise.all([r.getFile(),r.createWritable({keepExistingData:!0})]);await n.write({type:"write",position:i.size,data:t}),await n.close()}async readFile(e){return(await this.getFile(e)).getFile()}async deleteFile(e,t){let{name:r,dir:i}=this.parsePath(e);return(await this.getDirectory(i)).removeEntry(r,t)}async createFileURL(e){let t=await this.getFile(e),r=await t.getFile();return URL.createObjectURL(r)}revokeFileURL(e){URL.revokeObjectURL(e)}async logDirectoryTree(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";for await(let r of e.values())if("directory"===r.kind)console.log("".concat(t,"\uD83D\uDCC1 ").concat(r.name)),await this.logDirectoryTree(r,"".concat(t,"  "));else if("file"===r.kind){let e=await r.getFile();console.log("".concat(t,"\uD83D\uDCC4 ").concat(r.name," ").concat(e.size," bytes"))}}constructor(){(0,b._)(this,"rootDir",void 0),(0,b._)(this,"isAvailable",!0),this.rootDir=window.navigator.storage.getDirectory()}}var S=r(88812);(h||(h={})).DEFAULT="E_IDB_STORE";class D extends k.y{constructor(e="Idb store error",{code:t=h.DEFAULT,...r}={}){super(e,{code:t,...r}),(0,b._)(this,"name","IdbStoreException"),Object.setPrototypeOf(this,D.prototype)}}class _{async executeTransaction(e){let t=await this.idb;if(!this.isIdbAvailable||!t)throw new D("IdbStore is not available");return e(t)}async openIdb(){return new S.r("".concat("music_slam","_").concat(this.config.name)).openDB(this.config.version,{onBlocked:(e,t,r)=>{var i,n;this.onError(),null===(n=this.handlers)||void 0===n||null===(i=n.onBlocked)||void 0===i||i.call(n,e,t,r)},onBlocking:(e,t,r)=>{var i,n;this.onError(),null===(n=this.handlers)||void 0===n||null===(i=n.onBlocking)||void 0===i||i.call(n,e,t,r)},onTerminated:()=>{var e,t;this.onError(),null===(t=this.handlers)||void 0===t||null===(e=t.onTerminated)||void 0===e||e.call(t)},onUpgrade:(e,t,r,i,n)=>{var s,o;null===(o=this.handlers)||void 0===o||null===(s=o.onUpgrade)||void 0===s||s.call(o,e,t,r,i,n)}})}async onError(){await this.closeConnection(),this.attemptsConnection<this.config.restrictions.attemptsCount?(this.attemptsConnection++,this.idb=this.openIdb()):this.isIdbAvailable=!1}async closeConnection(){try{let e=await this.idb;e&&e.close()}catch(e){}}constructor({config:e,handlers:t}){(0,b._)(this,"idb",void 0),(0,b._)(this,"config",void 0),(0,b._)(this,"handlers",void 0),(0,b._)(this,"attemptsConnection",0),(0,b._)(this,"isIdbAvailable",!0),this.config=e,this.handlers=t,this.idb=this.openIdb()}}(s=v||(v={})).RESPONSE_CACHE="response_cache",s.TRACKS="tracks",s.ALBUMS="albums",s.ALBUMS_TRACKS="albums_tracks",s.ARTISTS="artists",s.ARTISTS_TRACKS="artists_tracks",s.USERS="users",s.USERS_TRACKS="users_tracks";let O={name:v.ALBUMS,version:1,restrictions:{attemptsCount:3,count:100}};class x extends _{async put(e){return this.executeTransaction(async t=>{var r;let i=await t.get(O.name,String(e.id)),n=Date.now(),s=null!==(r=null==i?void 0:i.createdAt)&&void 0!==r?r:n;return t.put(O.name,{meta:e,updatedAt:n,createdAt:s},String(e.id))}).catch(()=>{})}async get(e){return this.executeTransaction(async t=>{var r;let i=await t.get(O.name,e);return null!==(r=null==i?void 0:i.meta)&&void 0!==r?r:null}).catch(()=>{})}async delete(e){return this.executeTransaction(async t=>{await t.delete(O.name,e)}).catch(()=>{})}constructor(){super({config:O,handlers:{onUpgrade:e=>{e.createObjectStore(O.name)}}})}}let P={name:v.ALBUMS_TRACKS,version:1,restrictions:{attemptsCount:3}},L="albumId",U="trackId",N=(e,t)=>"".concat(e,":").concat(t);class F extends _{async put(e,t){return this.executeTransaction(async r=>r.put(P.name,{trackId:e,albumId:t},N(e,t))).catch(()=>{})}async getTracksByAlbumId(e){return this.executeTransaction(async t=>(await t.getAllFromIndex(P.name,L,e)).map(e=>e.trackId)).catch(()=>{})}async getAlbumsByTrackId(e){return this.executeTransaction(async t=>(await t.getAllFromIndex(P.name,U,e)).map(e=>e.albumId)).catch(()=>{})}async delete(e,t){return this.executeTransaction(async r=>{await r.delete(P.name,N(e,t))}).catch(()=>{})}async getCountByAlbum(e){return this.executeTransaction(async t=>t.countFromIndex(P.name,L,e)).catch(()=>{})}constructor(){super({config:P,handlers:{onUpgrade:e=>{let t=e.createObjectStore(P.name);t.createIndex(L,"albumId"),t.createIndex(U,"trackId")}}})}}let j={name:v.ARTISTS,version:1,restrictions:{attemptsCount:3,count:100}};class q extends _{async put(e){return this.executeTransaction(async t=>{var r;let i=await t.get(j.name,String(e.id)),n=Date.now(),s=null!==(r=null==i?void 0:i.createdAt)&&void 0!==r?r:n;return t.put(j.name,{meta:e,updatedAt:n,createdAt:s},String(e.id))}).catch(()=>{})}async get(e){return this.executeTransaction(async t=>{var r;let i=await t.get(j.name,e);return null!==(r=null==i?void 0:i.meta)&&void 0!==r?r:null}).catch(()=>{})}async delete(e){return this.executeTransaction(async t=>{await t.delete(j.name,e)}).catch(()=>{})}constructor(){super({config:j,handlers:{onUpgrade:e=>{e.createObjectStore(j.name)}}})}}let B={name:v.ARTISTS_TRACKS,version:1,restrictions:{attemptsCount:3}},H="artistId",K="trackId",M=(e,t)=>"".concat(e,":").concat(t);class W extends _{async put(e){let{trackId:t,artistId:r}=e;return this.executeTransaction(async i=>i.put(B.name,e,M(t,r))).catch(()=>{})}async getArtistsByTrackId(e){return this.executeTransaction(async t=>(await t.getAllFromIndex(B.name,K,e)).sort((e,t)=>e.artistIndex-t.artistIndex)).catch(()=>{})}async delete(e,t){return this.executeTransaction(async r=>{await r.delete(B.name,M(e,t))}).catch(()=>{})}async getCountByArtist(e){return this.executeTransaction(async t=>t.countFromIndex(B.name,H,e)).catch(()=>{})}constructor(){super({config:B,handlers:{onUpgrade:e=>{let t=e.createObjectStore(B.name);t.createIndex(K,"trackId"),t.createIndex(H,"artistId")}}})}}let z={name:v.RESPONSE_CACHE,version:1,restrictions:{attemptsCount:3,count:100}},G="priority_updatedAt",Y=(e,t)=>"".concat(e,":").concat(t);class V extends _{async put(e){return this.executeTransaction(async t=>{var r;let i=await this.get(e.uid,e.requestId),n=Date.now(),s=null!==(r=null==i?void 0:i.createdAt)&&void 0!==r?r:n,o={...e,updatedAt:n,createdAt:s},a=await t.count(z.name);return i||a<Number(z.restrictions.count)||await this.deleteResponseByLowPriority(),t.put(z.name,o,Y(e.uid,e.requestId))}).catch(()=>{})}async get(e,t,r){let i=await this.getResponse(e,t);return i&&r&&Date.now()-i.updatedAt>r?(await this.delete(e,t),null):null!=i?i:null}async getResponse(e,t){return this.executeTransaction(async r=>{let i=Y(e,t),n=await r.get(z.name,i);return null!=n?n:null}).catch(()=>{})}async delete(e,t){return this.executeTransaction(async r=>{await r.delete(z.name,Y(e,t))}).catch(()=>{})}async deleteResponseByLowPriority(){return this.executeTransaction(async e=>{let t=e.transaction([z.name],"readwrite").objectStore(z.name).index(G),r=await t.openCursor();return null==r?void 0:r.delete()}).catch(()=>{})}constructor(){super({config:z,handlers:{onUpgrade:e=>{e.createObjectStore(z.name).createIndex(G,["priority","updatedAt"])}}})}}let X={name:v.TRACKS,version:1,restrictions:{attemptsCount:3,count:100}};class Z extends _{async put(e){return this.executeTransaction(async t=>{var r;let i=await t.get(X.name,e.id),n=Date.now(),s=null!==(r=null==i?void 0:i.createdAt)&&void 0!==r?r:n;return t.put(X.name,{meta:e,updatedAt:n,createdAt:s},e.id)}).catch(()=>{})}async get(e){return this.executeTransaction(async t=>{let r=await t.get(X.name,e);return null!=r?r:null}).catch(()=>{})}async putDecryptKey(e,t){return this.executeTransaction(async r=>{var i;let n=await r.get(X.name,e);if(!n)return;let s=Date.now(),o=null!==(i=null==n?void 0:n.createdAt)&&void 0!==i?i:s;return r.put(X.name,{meta:n.meta,decryptKey:t,updatedAt:s,createdAt:o},e)}).catch(()=>{})}async getDecryptKey(e){return this.executeTransaction(async t=>{var r;let i=await t.get(X.name,e);return null!==(r=null==i?void 0:i.decryptKey)&&void 0!==r?r:null})}async delete(e){return this.executeTransaction(async t=>{await t.delete(X.name,e)}).catch(()=>{})}constructor(){super({config:X,handlers:{onUpgrade:e=>{e.createObjectStore(X.name)}}})}}let J={name:v.USERS,version:1,restrictions:{attemptsCount:3,count:100}};class Q extends _{async put(e){return this.executeTransaction(async t=>{var r;let i=await t.get(J.name,e.uid),n=Date.now(),s=null!==(r=null==i?void 0:i.createdAt)&&void 0!==r?r:n;return t.put(J.name,{...e,updatedAt:n,createdAt:s},e.uid)}).catch(()=>{})}async get(e){return this.executeTransaction(async t=>{let r=await t.get(J.name,e);return null!=r?r:null}).catch(()=>{})}async delete(e){return this.executeTransaction(async t=>{await t.delete(J.name,e)}).catch(()=>{})}constructor(){super({config:J,handlers:{onUpgrade:e=>{e.createObjectStore(J.name)}}})}}let $={name:v.USERS_TRACKS,version:1,restrictions:{attemptsCount:3}},ee="trackId",et=(e,t)=>"".concat(e,":").concat(t);class er extends _{async put(e){return this.executeTransaction(async t=>{var r;let i=et(e.uid,e.trackId),n=await t.get($.name,i),s=Date.now(),o=null!==(r=null==n?void 0:n.createdAt)&&void 0!==r?r:s;return t.put($.name,{...e,updatedAt:s,createdAt:o},i)}).catch(()=>{})}async getTracksByUid(e){return this.executeTransaction(async t=>(await t.getAllFromIndex($.name,"uid",e)).sort((e,t)=>e.createdAt-t.createdAt).map(e=>{let{trackId:t,albumId:r}=e;return r?"".concat(t,":").concat(r):t})).catch(()=>{})}async delete(e,t){return this.executeTransaction(async r=>{await r.delete($.name,et(e,t))}).catch(()=>{})}async getCountByTrackId(e){return this.executeTransaction(async t=>t.countFromIndex($.name,ee,e)).catch(()=>{})}constructor(){super({config:$,handlers:{onUpgrade:e=>{let t=e.createObjectStore($.name);t.createIndex("uid","uid"),t.createIndex(ee,"trackId")}}})}}let ei=e=>{let{useFileStorage:t,useResponseCacheStorage:r,useEntitiesStorage:i}=e,n={};return t&&(n.fileStorage=new I),r&&(n.responseCacheStore=new V),i&&(n.albumsStore=new x,n.albumsTracksStore=new F,n.artistsStore=new q,n.artistsTracksStore=new W,n.tracksStore=new Z,n.usersStore=new Q,n.usersTracksStore=new er),n};(o=g||(g={})).TRACK="track",o.ENTITY="entity",(a=f||(f={})).IDLE="IDLE",a.DOWNLOADING="DOWNLOADING",a.DOWNLOADED="DOWNLOADED",a.DOWNLOAD_FAILED="DOWNLOAD_FAILED";let en=async e=>{var t;let{trackId:r,storeContainer:i}=e,n=await (null===(t=i.albumsTracksStore)||void 0===t?void 0:t.getAlbumsByTrackId(r));null==n||n.forEach(async e=>{var t,n,s;await (null===(t=i.albumsTracksStore)||void 0===t?void 0:t.delete(r,e)),0===await (null===(n=i.albumsTracksStore)||void 0===n?void 0:n.getCountByAlbum(e))&&(null===(s=i.albumsStore)||void 0===s||s.delete(e))})},es=async e=>{var t;let{trackId:r,storeContainer:i}=e,n=await (null===(t=i.artistsTracksStore)||void 0===t?void 0:t.getArtistsByTrackId(r));null==n||n.forEach(async e=>{var t,n,s;let{artistId:o}=e;await (null===(t=i.artistsTracksStore)||void 0===t?void 0:t.delete(r,o)),0===await (null===(n=i.artistsTracksStore)||void 0===n?void 0:n.getCountByArtist(o))&&(null===(s=i.artistsStore)||void 0===s||s.delete(o))})},eo=async e=>{var t,r;let{trackId:i,albumId:n,storeContainer:s}=e,o=[];if(n){let e=await (null===(t=s.albumsStore)||void 0===t?void 0:t.get(n));e&&o.push({...e,artists:[]})}else{let e=await (null===(r=s.albumsTracksStore)||void 0===r?void 0:r.getAlbumsByTrackId(i));null==e||e.forEach(async e=>{var t;let r=await (null===(t=s.albumsStore)||void 0===t?void 0:t.get(e));r&&o.push({...r,artists:[]})})}return o},ea=e=>"object"==typeof e&&"id"in e,ec=async e=>{var t;let r,{trackId:i,storeContainer:n}=e,s=await (null===(t=n.artistsTracksStore)||void 0===t?void 0:t.getArtistsByTrackId(i)),o=[];return null==s||s.forEach(async e=>{var t;let{artistId:i,decomposed:s,prefix:a}=e,c=await (null===(t=n.artistsStore)||void 0===t?void 0:t.get(i));if(c){if(!s&&ea(c)){r=c,o.push(c);return}r&&(void 0===r.decomposed&&(r.decomposed=[]),a&&r.decomposed.push(a),r.decomposed.push(c))}}),o},eu=e=>"tracks/".concat(e),el=e=>{var t;let{track:r,storeContainer:i}=e;null===(t=r.albums)||void 0===t||t.forEach(async e=>{var t,n;let{artists:s,...o}=e;await Promise.all([null===(t=i.albumsStore)||void 0===t?void 0:t.put(o),null===(n=i.albumsTracksStore)||void 0===n?void 0:n.put(String(r.id),String(o.id))])})},ed=e=>{var t;let{track:r,storeContainer:i}=e,n=0;if(!r.artists)return;let s=[];null===(t=r.artists)||void 0===t||t.forEach(e=>{let{decomposed:t,...i}=e;s.push({artistMeta:i,artistTrack:{artistId:String(e.id),trackId:String(r.id),artistIndex:n}}),n++;let o="";t&&t.length>0&&t.forEach(e=>{if("string"==typeof e){o=e;return}s.push({artistMeta:e,artistTrack:{artistId:String(e.id),trackId:String(r.id),artistIndex:n,decomposed:!0,prefix:o}}),n++,o=""})}),s.forEach(async e=>{var t,r;let{artistMeta:n,artistTrack:s}=e;await Promise.all([null===(t=i.artistsStore)||void 0===t?void 0:t.put(n),null===(r=i.artistsTracksStore)||void 0===r?void 0:r.put(s)])})};(y||(y={})).TRACK_CHANGED="track_changed";class eh{async init(){let e=await this.getTracks();this.state=e.reduce((e,t)=>(e[String(t.id)]={state:f.DOWNLOADED},e),{})}download(e){this.downloader.downloadTrack(e)}async getTracks(){var e;let t=await (null===(e=this.storeContainer.usersTracksStore)||void 0===e?void 0:e.getTracksByUid(this.userConfig.uid));return t?(await Promise.all(null==t?void 0:t.map(async e=>this.getTrack(e)))).filter(e=>null!==e):[]}async getTrack(e){var t;let[r,i]=(0,T.fU)(e);if(!r)return null;let n=await (null===(t=this.storeContainer.tracksStore)||void 0===t?void 0:t.get(r));if(!n)return null;let s=n.meta;return s.albums=await eo({trackId:String(s.id),albumId:i,storeContainer:this.storeContainer}),s.artists=await ec({trackId:String(s.id),storeContainer:this.storeContainer}),s}async deleteTrack(e){var t,r,i,n;let[s]=(0,T.fU)(e);s&&(null===(t=this.storeContainer.usersTracksStore)||void 0===t||t.delete(this.userConfig.uid,s),0===await (null===(r=this.storeContainer.usersTracksStore)||void 0===r?void 0:r.getCountByTrackId(s))&&(null===(i=this.storeContainer.fileStorage)||void 0===i||i.deleteFile(eu(s)),await (null===(n=this.storeContainer.tracksStore)||void 0===n?void 0:n.delete(s)),en({trackId:s,storeContainer:this.storeContainer}),es({trackId:s,storeContainer:this.storeContainer})))}onTrackMetaReceived(e){var t,r,i,n;this.changeState(String(e.id),{state:f.DOWNLOADING}),el({track:e,storeContainer:this.storeContainer}),ed({track:e,storeContainer:this.storeContainer}),null===(i=this.storeContainer.usersTracksStore)||void 0===i||i.put({uid:this.userConfig.uid,trackId:String(e.id),albumId:null===(r=e.albums)||void 0===r?void 0:null===(t=r[0])||void 0===t?void 0:t.id,downloadSource:g.TRACK}),delete e.albums,delete e.artists,null===(n=this.storeContainer.tracksStore)||void 0===n||n.put(e)}onTrackDecryptKeyReceived(e,t){var r;null===(r=this.storeContainer.tracksStore)||void 0===r||r.putDecryptKey(e,t)}onChunkMediaFileReceived(e,t){var r;let{data:i,progress:n}=t;null===(r=this.storeContainer.fileStorage)||void 0===r||r.appendFile(eu(e),i),this.changeState(e,{state:f.DOWNLOADING,progress:n})}changeState(e,t){this.state[e]=t,this.events.emit(y.TRACK_CHANGED,t)}constructor(e){(0,b._)(this,"userConfig",void 0),(0,b._)(this,"downloader",void 0),(0,b._)(this,"storeContainer",void 0),(0,b._)(this,"state",{}),(0,b._)(this,"events",new w.Q),this.userConfig=e.userConfig,this.downloader=e.downloader,this.storeContainer=e.storeContainer,this.init(),this.downloader.events.on(l.TRACK_META_RECEIVED,this.onTrackMetaReceived.bind(this)),this.downloader.events.on(l.TRACK_DECRYPT_KEY_RECEIVED,this.onTrackDecryptKeyReceived.bind(this)),this.downloader.events.on(l.CHUNK_MEDIA_FILE_RECEIVED,this.onChunkMediaFileReceived.bind(this))}}class ev{init(e){var t;let{userConfig:r,downloaderConfig:i}=e;this.userConfig=r,this.downloader=new E(i),null===(t=this.storeContainer.usersStore)||void 0===t||t.put({uid:r.uid}),this.tracks=new eh({userConfig:this.userConfig,downloader:this.downloader,storeContainer:this.storeContainer})}constructor(e){(0,b._)(this,"network",new C),(0,b._)(this,"storeContainer",void 0),(0,b._)(this,"config",void 0),(0,b._)(this,"tracks",null),(0,b._)(this,"userConfig",null),(0,b._)(this,"downloader",null),this.config=e,this.storeContainer=ei(this.config)}}(c=m||(m={}))[c.LOW=1]="LOW",c[c.MEDIUM=2]="MEDIUM",c[c.HIGH=3]="HIGH",(u=p||(p={})).DEFAULT="E_RESOURCE_PROXY",u.CACHE_NOT_FOUND="E_RESOURCE_PROXY_CACHE_NOT_FOUND",u.UID_NOT_FOUND="E_RESOURCE_PROXY_UID_NOT_FOUND";class eg extends k.y{constructor(e="Resource proxy error",{code:t=p.DEFAULT,...r}={}){super(e,{code:t,...r}),(0,b._)(this,"name","ResourceProxyException"),Object.setPrototypeOf(this,eg.prototype)}}let ef=async(e,t)=>{let{uid:r,requestId:i,ttl:n}=t,s=await e.get(r,i,n);if(s)return s.response;throw new eg("Cache not found",{code:p.CACHE_NOT_FOUND,data:{uid:r,requestId:i}})},ey=(e,t)=>{var r,i,n,s;let o=null===(r=e.overrides)||void 0===r?void 0:r[t];return{enabled:null!==(i=null==o?void 0:o.enabled)&&void 0!==i?i:e.enabled,ttl:null!==(n=null==o?void 0:o.ttl)&&void 0!==n?n:e.ttl,priority:null!==(s=null==o?void 0:o.priority)&&void 0!==s?s:e.priority}};var em=r(60991);let ep=async(e,t,r)=>{let{uid:i,requestId:n,ttl:s}=r;if(!i)throw new eg("Uid not found",{code:p.UID_NOT_FOUND,data:{requestId:n}});if(!(e instanceof em.du)||e.statusCode===em.CN.REQUEST_TIMEOUT)return ef(t,{uid:i,requestId:n,ttl:s});throw e},eb=(e,t)=>{let r=new V;return new Proxy(e,{get(e,i){let n=e[i],{enabled:s,ttl:o,priority:a}=ey(t,i);return"function"==typeof n&&s?async function(){for(var s=arguments.length,c=Array(s),u=0;u<s;u++)c[u]=arguments[u];let{uid:l,resourceName:d,isOffline:h}=t.common,v=[d,i,...c].join("-");if(h&&l)return ef(r,{uid:l,requestId:v,ttl:o});switch(i){case"experiments":case"experimentsDetails":case"settings":try{let t=await n.apply(e,c);return l&&r.put({uid:l,requestId:v,priority:null!=a?a:m.LOW,response:t}),t}catch(e){return ep(e,r,{uid:l,requestId:v,ttl:o})}case"about":try{let t=await n.apply(e,c);return r.put({uid:t.uid,requestId:v,priority:null!=a?a:m.LOW,response:t}),t}catch(e){return ep(e,r,{uid:l,requestId:v,ttl:o})}default:return n.apply(e,c)}}:n}})}}}]);