"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4093],{94093:function(e,t,i){i.d(t,{Xb:function(){return P.AlbumPage},Lf:function(){return O}});var l,a,n,r=i(97898),s=i(23874),o=i(43236),d=i(1925),u=i(81337),m=i(62812);(a||(a={})).RECENT_ALBUMS="recent-albums",(l=n||(n={}))[l.DAY=1]="DAY",l[l.WEEK=7]="WEEK",l[l.MONTH=30]="MONTH";var g=i(46537),b=i(13555),E=i(88217),v=i(24980),c=i(43683),A=i(20794),h=i(15526);let G=(e,t)=>e.map(e=>"".concat(e,":").concat(t));var p=i(54146);let S=e=>({type:c.lf.TEXT,data:e||null}),N=e=>{var t;return(0,r.pj)({type:(null===(t=e.data)||void 0===t?void 0:t.type)||m.V.TRACK,id:e.id,data:e.data||null,loadingState:e.loadingState,position:e.position,isBest:e.isBest,positionInContext:e.positionInContext,hasEverFinished:e.hasEverFinished})},I=e=>"".concat(e,"-text"),y=e=>String(e),f=(e,t,i,l)=>{e.forEach(e=>{var a;if(null===(a=e.albums)||void 0===a?void 0:a[0]){let a=i.get(y(e.id));null==a||a.forEach(i=>{var a,n,r;let s=t[i];t[i]=N({id:e.id,loadingState:A.Gui.RESOLVE,positionInContext:null==s?void 0:s.positionInContext,data:(0,p.Vt)(e,{hasEverFinished:null==s?void 0:s.hasEverFinished}),position:null===(r=e.albums)||void 0===r?void 0:null===(n=r[0])||void 0===n?void 0:null===(a=n.trackPosition)||void 0===a?void 0:a.index,isBest:null==l?void 0:l.includes(Number(e.id)),hasEverFinished:null==s?void 0:s.hasEverFinished})});let n=i.get(I(e.id));null==n||n.forEach(i=>{var l,a,n;t[i]=S(null===(n=e.albums)||void 0===n?void 0:null===(a=n[0])||void 0===a?void 0:null===(l=a.trackPosition)||void 0===l?void 0:l.volume)})}})},C=(e,t,i)=>{let l=0;e.volumes.forEach(a=>{e.volumes.length>1&&a[0]&&(t.push(S()),i.set(I(a[0].id),[t.length-1])),a.forEach(e=>{t.push(N({id:e.id,loadingState:A.Gui.IDLE,positionInContext:l}));let a=i.get(String(e.id));i.set(y(e.id),a?[...a,t.length-1]:[t.length-1]),l++})})},T=e=>(0,r.pj)({id:e.id,type:e.type,title:e.title,albums:e.albums.map(b.ym)}),D=(e,t,i,l)=>{e.forEach(e=>{let a=i.get(String(e));null==a||a.forEach(i=>{var a,n;t[i]=N({id:e,loadingState:l,positionInContext:null===(a=t[i])||void 0===a?void 0:a.positionInContext,hasEverFinished:null===(n=t[i])||void 0===n?void 0:n.hasEverFinished})})})},V=r.V5.model("AlbumDonations",{loadingState:r.V5.enumeration(Object.values(A.Gui)),items:r.V5.maybeNull(r.V5.array(E.Ew))}),L=r.V5.model("LabelItem",{id:r.V5.number,name:r.V5.string}),R=r.V5.model("RelatedAlbumsPage",{loadingState:r.V5.enumeration(Object.values(A.Gui)),items:r.V5.array(b.ug)}),k=r.V5.model("RelatedContent",{loadingState:r.V5.enumeration(Object.values(A.Gui)),items:r.V5.maybeNull(r.V5.array(g.fd))}),O=r.V5.compose(r.V5.model("AlbumPage",{id:r.V5.maybeNull(r.V5.number),meta:r.V5.maybeNull(b.ug),items:r.V5.array(g.JP),indexItems:r.V5.map(r.V5.array(r.V5.number)),loadingState:r.V5.enumeration(Object.values(A.Gui)),errorStatusCode:r.V5.maybeNull(r.V5.number),deprecationTargetAlbumId:r.V5.maybeNull(r.V5.number),latestGenreAlbums:R,otherArtistAlbums:R,otherAlbumVersions:r.V5.array(b.ug),labels:r.V5.maybeNull(r.V5.array(L)),description:r.V5.maybe(r.V5.string),donations:V,relatedContent:k,allTracksUnfinished:r.V5.boolean}),h.ie).views(e=>({get isNonMusicType(){var t;if(null===(t=e.meta)||void 0===t?void 0:t.type)return[o.V.PODCAST,o.V.AUDIOBOOK].includes(e.meta.type);return!1},get isOtherArtistAlbumsAvailable(){var i,l,a,n;return!!(!this.isNonMusicType&&(null===(l=e.meta)||void 0===l?void 0:null===(i=l.artists)||void 0===i?void 0:i.length)===1&&!(null===(n=e.meta)||void 0===n?void 0:null===(a=n.artists[0])||void 0===a?void 0:a.various))},get isLatestGenreAlbumsAvailable(){var r;return!!(!this.isNonMusicType&&(null===(r=e.meta)||void 0===r?void 0:r.genre))},get isNotFound(){return e.loadingState===A.Gui.REJECT&&e.errorStatusCode===s.CN.NOT_FOUND},get isRejected(){return e.loadingState===A.Gui.REJECT},get hasOtherAlbumVersions(){return!!(e.loadingState===A.Gui.IDLE||e.loadingState===A.Gui.PENDING||e.otherAlbumVersions&&e.otherAlbumVersions.length>0)},get hasLatestGenreAlbums(){return!!(e.latestGenreAlbums.loadingState===A.Gui.IDLE||e.latestGenreAlbums.loadingState===A.Gui.PENDING||e.latestGenreAlbums.items&&e.latestGenreAlbums.items.length>0)},get hasOtherArtistAlbums(){return!!(e.otherArtistAlbums.loadingState===A.Gui.IDLE||e.otherArtistAlbums.loadingState===A.Gui.PENDING||e.otherArtistAlbums.items&&e.otherArtistAlbums.items.length>0)},get isLoading(){return e.loadingState===A.Gui.IDLE||e.loadingState===A.Gui.PENDING},get isLoaded(){return e.loadingState===A.Gui.RESOLVE},get isLatestGenreAlbumsLoading(){return e.latestGenreAlbums.loadingState===A.Gui.IDLE||e.latestGenreAlbums.loadingState===A.Gui.PENDING},get isOtherArtistAlbumsLoading(){return e.otherArtistAlbums.loadingState===A.Gui.IDLE||e.otherArtistAlbums.loadingState===A.Gui.PENDING},get isRelatedContentLoading(){return e.relatedContent.loadingState===A.Gui.IDLE||e.relatedContent.loadingState===A.Gui.PENDING},get contextMeta(){var d,u,m,g,b,E,v,h,G,p;return{id:e.meta.id,title:null===(d=e.meta)||void 0===d?void 0:d.title,coverUri:null===(u=e.meta)||void 0===u?void 0:u.coverUri,type:null===(m=e.meta)||void 0===m?void 0:m.type,year:null===(g=e.meta)||void 0===g?void 0:g.year,version:null===(b=e.meta)||void 0===b?void 0:b.version,contentWarning:null===(E=e.meta)||void 0===E?void 0:E.contentWarning,genre:null===(v=e.meta)||void 0===v?void 0:v.genre,likesCount:null===(h=e.meta)||void 0===h?void 0:h.likesCount,averageColor:null===(G=e.meta)||void 0===G?void 0:G.averageColor,available:null===(p=e.meta)||void 0===p?void 0:p.isAvailable}},get lastEpisodes(){return e.items.filter(e=>e.type!==c.lf.TEXT).slice(0,5).map(e=>e)},get lastEpisodesTrackIds(){return this.lastEpisodes.map(e=>e.id)}})).actions(e=>{let t={setAlbumUnfinished:()=>{var i;t.markUnfinished({albumId:e.id||0}),null===(i=e.meta)||void 0===i||i.updateFinished(!1)},setAllTracksUnfinished:t=>{e.allTracksUnfinished=t},checkAllAlbumTrackFinished:()=>{var i,l;e.items.filter(e=>{let{type:t,data:i}=e;return i&&t!==c.lf.TEXT}).every(e=>{var t;let{data:i}=e;return null==i?void 0:null===(t=i.streamProgress)||void 0===t?void 0:t.hasEverFinished})&&((null===(i=e.meta)||void 0===i?void 0:i.listeningFinished)||(t.markFinished({albumId:Number(e.id)}),null===(l=e.meta)||void 0===l||l.updateFinished(!0)))},markTracksFinished:t=>{let{withoutTracks:i=[]}=t;e.items.forEach(e=>{if(e.type===c.lf.TEXT)return;let{data:t}=e;if(!(t&&i.includes(t.id))){if(t){var l;null===(l=t.streamProgress)||void 0===l||l.updateEverFinished(!0)}else e.updateEverFinished(!0)}})},markFinished:(0,r.ls)(function*(t){let{streamsResource:i,modelActionsLogger:l}=(0,r.dU)(e);try{return yield i.markAlbumFinished(t)}catch(e){return l.error(e),d.P.ERROR}}),markUnfinished:(0,r.ls)(function*(t){let{streamsResource:i,modelActionsLogger:l}=(0,r.dU)(e);try{return yield i.markAlbumUnfinished(t)}catch(e){return l.error(e),d.P.ERROR}}),getLatestGenreAlbums:(0,r.ls)(function*(t){let{topResource:i,modelActionsLogger:l}=(0,r.dU)(e);if(e.latestGenreAlbums.loadingState!==A.Gui.PENDING)try{e.latestGenreAlbums.loadingState=A.Gui.PENDING;let l=yield i.getTopByGenre(t);e.latestGenreAlbums.items=(0,r.pj)(l.albums.map(b.ym)),e.latestGenreAlbums.loadingState=A.Gui.RESOLVE}catch(t){l.error(t),e.latestGenreAlbums.loadingState=A.Gui.REJECT}}),getOtherArtistAlbums:(0,r.ls)(function*(t,i){let{artistsResource:l,modelActionsLogger:a}=(0,r.dU)(e);if(e.otherArtistAlbums.loadingState!==A.Gui.PENDING)try{if(!t.artistId){e.otherArtistAlbums.loadingState=A.Gui.REJECT;return}e.otherArtistAlbums.loadingState=A.Gui.PENDING;let a=yield l.getSafeDirectAlbums({...t,artistId:t.artistId});e.otherArtistAlbums.items=(0,r.pj)(a.albums.filter(e=>String(e.id)!==String(i)).map(b.ym)),e.otherArtistAlbums.loadingState=A.Gui.RESOLVE}catch(t){a.error(t),e.otherArtistAlbums.loadingState=A.Gui.REJECT}}),getTracks:(0,r.ls)(function*(t){let{trackIds:i}=t,{tracksResource:l,modelActionsLogger:a}=(0,r.dU)(e);try{var n;if(!(null===(n=e.meta)||void 0===n?void 0:n.id))return;D(i,e.items,e.indexItems,A.Gui.PENDING);let t=yield l.getTracksMeta({trackIds:G(i,e.meta.id),withProgress:!0});f(t,e.items,e.indexItems,e.meta.bestAlbumTracks)}catch(t){a.error(t),D(i,e.items,e.indexItems,A.Gui.REJECT)}}),getDonations:(0,r.ls)(function*(t){let{albumId:i}=t,{experiments:l}=(0,r.yj)(e),{donationResource:a,modelActionsLogger:n}=(0,r.dU)(e);if(l.checkExperiment(A.peG.WebNextAlbumDonateChooserButton,"on")&&e.donations.loadingState!==A.Gui.PENDING)try{e.donations.loadingState=A.Gui.PENDING;let{donations:t}=yield a.getAlbumDonations({albumId:i});t&&(e.donations.items=(0,r.pj)(t.map(E.fv))),e.donations.loadingState=A.Gui.RESOLVE}catch(t){n.error(t),e.donations.loadingState=A.Gui.REJECT}}),getData:(0,r.ls)(function*(i){let{albumId:l,resumeStream:d,preloadedAlbum:g}=i,{albumResource:E,modelActionsLogger:c}=(0,r.dU)(e),{experiments:h,disclaimer:G}=(0,r.yj)(e),p=h.checkExperiment(A.peG.WebNextAlbumDisableVersions,"on"),S=h.checkExperiment(A.peG.WebNextAlbumDisableTracks,"on"),N=h.checkExperiment(A.peG.WebNextAlbumDisableLatestGenreAlbums,"on"),I=h.checkExperiment(A.peG.WebNextAlbumDisableOtherArtistAlbums,"on"),y=h.checkExperiment(A.peG.WebNextLegalRejectAlbum,"on"),f=h.checkExperiment(A.peG.WebNextAgentPodcast,"on");if(e.id=l,e.loadingState!==A.Gui.PENDING)try{var T,D,V,L,R;let i,c;e.loadingState=A.Gui.PENDING;let h=g;if(h||(h=yield E.getAlbumWithTracksIds({albumId:l,resumeStream:d})),(null==h?void 0:h.error)==="not-found"){e.errorStatusCode=s.CN.NOT_FOUND,e.loadingState=A.Gui.REJECT,e.otherArtistAlbums.loadingState=A.Gui.REJECT,e.latestGenreAlbums.loadingState=A.Gui.REJECT;return}if(null===(T=h.deprecation)||void 0===T?void 0:T.targetAlbumId){e.deprecationTargetAlbumId=h.deprecation.targetAlbumId,e.loadingState=A.Gui.RESOLVE;return}let k=(null!==(D=h.disclaimers)&&void 0!==D?D:[]).includes(u.e.MODAL),O=h.type===o.V.PODCAST&&(null!==(V=h.disclaimers)&&void 0!==V?V:[]).includes(u.e.FOREIGN_AGENT);(k&&y||f&&O)&&(yield G.getAlbumDisclaimer({albumId:l}));let{sonataState:P}=(0,r.yj)(e);if(P.setUnloadedEntitiesData(h.volumes.flat().map(e=>(0,v.RN)(e.id))),e.meta=(0,b.ym)(h),e.labels=(0,r.pj)(h.labels),e.contentWarning=(0,r.pj)(h.contentWarning),e.description=(0,r.pj)(h.description),!p&&h.duplicates&&h.duplicates.length>0&&(e.otherAlbumVersions=(0,r.pj)(null===(L=h.duplicates)||void 0===L?void 0:L.map(b.ym))),!S){C(h,e.items,e.indexItems);let i=[];for(let t=0;t<10;t++){let l=e.items[t];(null==l?void 0:l.type)===m.V.TRACK&&i.push(String(l.id))}yield t.getTracks({trackIds:i})}!N&&e.isLatestGenreAlbumsAvailable?i=t.getLatestGenreAlbums({category:a.RECENT_ALBUMS,period:n.WEEK,pageSize:8,genre:h.genre}):e.latestGenreAlbums.loadingState=A.Gui.RESOLVE,!I&&e.isOtherArtistAlbumsAvailable?c=t.getOtherArtistAlbums({artistId:String(null===(R=h.artists[0])||void 0===R?void 0:R.id),limit:8},l):e.otherArtistAlbums.loadingState=A.Gui.RESOLVE,yield Promise.allSettled([i,c]),e.loadingState!==A.Gui.IDLE&&(e.loadingState=A.Gui.RESOLVE)}catch(t){c.error(t),t instanceof s.du&&(t.statusCode===s.CN.NOT_FOUND||t.statusCode===s.CN.BAD_REQUEST)&&(e.errorStatusCode=s.CN.NOT_FOUND),e.loadingState!==A.Gui.IDLE&&(e.loadingState=A.Gui.REJECT,e.otherArtistAlbums.loadingState=A.Gui.REJECT,e.latestGenreAlbums.loadingState=A.Gui.REJECT)}}),loadLastEpisodes(){t.getTracks({trackIds:e.lastEpisodesTrackIds})},getRelatedContent:(0,r.ls)(function*(){let{albumResource:t,modelActionsLogger:i}=(0,r.dU)(e);if(e.relatedContent.loadingState!==A.Gui.PENDING)try{var l,a;if(!(null===(l=e.meta)||void 0===l?void 0:l.id))return;e.relatedContent.loadingState=A.Gui.PENDING;let i=yield t.getRelatedContent({albumId:e.meta.id});e.relatedContent.items=(0,r.pj)(null===(a=i.blocks)||void 0===a?void 0:a.map(T)),e.relatedContent.loadingState=A.Gui.RESOLVE}catch(t){i.error(t),e.relatedContent.loadingState=A.Gui.REJECT}}),reset(){let{sonataState:t}=(0,r.yj)(e);t.resetUnloadedEntitiesData(),e.id=null,e.meta=null,e.errorStatusCode=null,e.deprecationTargetAlbumId=null,e.items=(0,r.pj)([]),e.indexItems.clear(),e.loadingState=A.Gui.IDLE,e.donations.loadingState=A.Gui.IDLE,e.donations.items=null,e.latestGenreAlbums.loadingState=A.Gui.IDLE,e.latestGenreAlbums.items=(0,r.pj)([]),e.otherArtistAlbums.loadingState=A.Gui.IDLE,e.otherArtistAlbums.items=(0,r.pj)([]),e.otherAlbumVersions=(0,r.pj)([]),e.description="",e.labels=null,e.relatedContent.loadingState=A.Gui.IDLE,e.relatedContent.items=null,e.allTracksUnfinished=!1}};return t});i(50193);var P=i(29086)}}]);